# Preprocess Carla Frames

Данный репозиторий посвящен распознаванию классов линий с помощью размеченных изображений из Carla

# Сборка проекта
```sh
python3.9 -m venv env    
source env/bin/activate
pip install -r requirements.txt
```

# Как использовать
Запуск осуществляется с помощью команды
```sh
python main.py --conf config.yaml
```
В файле config.yaml можно заменить поля `source_rgb`, `source_mask` и `destination_to_save` на свои собственные.

Папка [data](/data) существуюет для примера. В папках [data/rgb](/data/rgb) и [data/mask](/data/mask) лежат примеры входные данных для `main.py`. В папке [data/outputs/](/data/outputs/) результат работы `main.py`, а именно
1. [mask](/data/outputs/mask/) --- в точности то, что лежало в [data/mask](/data/mask)
2. [rgb](/data/outputs/mask/) --- в точности то, что лежало в [data/rgb](/data/rgb)
3. [result](/data/outputs/result/) --- результат работы в виде картинки
4. [line_info](/data/outputs/line_info/) --- размеченные типы линий дорожной разметки.

# Описание структуры проекта
- [main.py](/main.py):
    запускает процесс обработки в 3 этапа
    1. парсит config.yaml, вытаскивает пути и переменные
    2. процесс обработки изображений (весь функционал в CV_algs)
        на текущий момент результат не записывается если не нашлась полоса (чтобы поменять надо удалить один if)
        это было встроено для улечшения данных для обучения
        Также содержит функцию упрощенной классификации, которая снижает количество классов, на его основе можно делать свой
    3. строит csv файл для обучения
- [documentation.ipynb](/documentation.ipynb): 
    это копия main.py только с возможностью визуализации каждого процесса
    Каждый шаг имеет документацию, поэтому подробнее о алгоритме смотри в самом файле.
- [configs.py](/Configs/configs.py)
    файл configs содержит конфигурационные параметры для обработки изображения
    CLASSES, SIDES не менять, остальное можно менять.
    Совет: изменения проверять с помощью documentation.ipynd, включив флаги visualisation = True diagnostics = True
    везде где это возможно.


### Замечания
В CV_algs есть возможность создания кеша для сохранения и переиспользования предыдущих результатов, но она выключена внутри, так как не закончили настроку замыкания данных где то снаружи.

Не настроена классификация разницы между SOLID_DASH и DASH_SOLID, требуется дополнительная настройка

Допустим фит параметров из configs, точная настройка имеет место.

Не настроен перевод из пикселей в метры, пока это работает "на глаз"
    